<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<style>
  body { margin: 0; background: transparent; }
  #vikunja-dashboard {
    background: #121212; color: #fff;
    font-family: sans-serif; padding: 16px;
    border-radius: 16px; border: 1px solid #333;
    width: auto; max-width: 100%;
    box-sizing: border-box;
  }
  .task-list {
    display: flex; flex-direction: column;
    gap: 10px; max-height: 500px;
    overflow-y: auto;
  }
</style>
</head>
<body>

<div id="vikunja-dashboard">
  <div style="display: flex; 
      justify-content: space-between; 
      margin-bottom: 16px;">
    <span style="font-weight:700;">ğŸˆâ€â¬› TASK CENTER</span>
    <span id="task-count" style="
        background: #4db8ff; color: #000;
        padding: 2px 8px; border-radius: 20px;
        font-size: 0.8em;">0</span>
  </div>
  <div id="task-list" class="task-list">
    <div id="status-msg" style="text-align: center; 
        color: #666; padding: 20px;">
      åŒæ­¥ä¸­... ğŸ”„
    </div>
  </div>
</div>

<script>
(async () => {
  const listEl = document.getElementById('task-list');
  const statusEl = document.getElementById('status-msg');
  const countEl = document.getElementById('task-count');

  const url = 'https://todo.yichlin.com/api/v1/tasks/all';
  const token = 'tk_e4a6e6cb708078e7030e2fccab83ae88e06cadd3';
  const params = new URLSearchParams({
    'filter': 'due_date <= now/d+1d && done = false',
    'filter_timezone': 'Asia/Taipei'
  });

  try {
    console.log("é–‹å§‹è«‹æ±‚ API...");
    const res = await fetch(`${url}?${params}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    if (!res.ok) {
      throw new Error(`API éŒ¯èª¤: ${res.status}`);
    }

    const tasks = await res.json();
    console.log("å–å¾—è³‡æ–™:", tasks);

    if (!Array.isArray(tasks)) {
      throw new Error("å›å‚³æ ¼å¼ä¸¦éé™£åˆ—ï¼Œè«‹æª¢æŸ¥ Token");
    }

    listEl.innerHTML = '';
    const now = new Date();
    const todayTasks = tasks.filter(t => {
      if (!t.due_date || t.due_date.startsWith('0001')) 
        return false;
      return new Date(t.due_date).toDateString() === 
             now.toDateString();
    });

    countEl.innerText = todayTasks.length;

    if (todayTasks.length === 0) {
      listEl.innerHTML = '<div style="text-align:center; padding:20px;">ğŸ¾ ä»Šæ—¥ç„¡ä»»å‹™</div>';
      return;
    }

    // ... (é€™è£¡ä¿ç•™ä¹‹å‰çš„æ¸²æŸ“ card é‚è¼¯) ...
    todayTasks.forEach(t => {
      const card = document.createElement('div');
      card.style.cssText = `background:#1e1e1e; padding:10px; border-radius:8px; border-left:4px solid #4db8ff; font-size:0.9em;`;
      card.innerHTML = `<div>${t.title}</div>`;
      listEl.appendChild(card);
    });

  } catch (err) {
    console.error(err);
    listEl.innerHTML = `<div style="color:#ff4d4d; padding:10px;">âŒ éŒ¯èª¤: ${err.message}</div>`;
  }
})();
</script>
</body>
</html>
